# 登录页面验证码功能说明

## 功能概述
为登录页面添加了一个三字符的验证码功能，包含数字和字母，提高登录安全性。

## 功能特点

### 1. 验证码生成
- **字符集**: 包含大小写字母和数字（排除容易混淆的字符如 0、O、1、I、l）
- **长度**: 固定3位字符
- **随机性**: 每次生成都是随机的字符组合
- **字符集**: `ABCDEFGHJKMNPQRSTUVWXYZabcdefghjkmnpqrstuvwxyz23456789`

### 2. 用户界面
- **输入框**: 限制最大输入3个字符
- **验证码显示**: 带有渐变背景的显示区域
- **刷新按钮**: 点击可重新生成验证码
- **点击验证码**: 直接点击验证码区域也可刷新

### 3. 验证逻辑
- **大小写不敏感**: 用户输入时不区分大小写
- **实时验证**: 表单提交时进行验证
- **错误处理**: 验证码错误时显示提示并自动刷新
- **自动刷新**: 登录失败或验证失败时自动刷新验证码

### 4. 样式设计
- **Canvas绘制**: 使用HTML5 Canvas绘制验证码，支持复杂效果
- **透明背景**: 更加透明的背景，与登录页面更好融合
- **遮掩线**: 添加5条随机干扰线，增加破解难度
- **干扰点**: 随机分布的干扰点，进一步增强安全性
- **字符变形**: 每个字符随机旋转和位置偏移
- **响应式交互**: 鼠标悬停时有缩放效果和模糊背景
- **颜色随机**: 字符和干扰线使用随机颜色

## 使用方法

### 1. 页面加载
- 页面加载时自动生成第一个验证码
- 验证码显示在密码输入框下方

### 2. 用户操作
1. 输入用户名和密码
2. 查看验证码并在输入框中输入（不区分大小写）
3. 如果看不清验证码，可以：
   - 点击验证码区域刷新
   - 点击"刷新"按钮
4. 点击登录按钮提交表单

### 3. 验证流程
1. 表单验证（用户名、密码、验证码格式）
2. 验证码校验（与生成的验证码对比）
3. 如果验证码正确，发送登录请求
4. 如果验证码错误，显示错误信息并刷新验证码

## 技术实现

### 1. 数据结构
```javascript
// 表单数据
ruleForm: {
  loginAct: '',
  loginPwd: '',
  captcha: ''  // 新增验证码字段
}

// 验证码相关
captchaCode: '',      // 显示的验证码
captchaAnswer: '',    // 用于验证的小写版本
```

### 2. 核心方法
```javascript
// 生成验证码
generateCaptcha() {
  const chars = 'ABCDEFGHJKMNPQRSTUVWXYZabcdefghjkmnpqrstuvwxyz23456789';
  let result = '';
  for (let i = 0; i < 3; i++) {
    result += chars.charAt(Math.floor(Math.random() * chars.length));
  }
  this.captchaCode = result;
  this.captchaAnswer = result.toLowerCase();

  // 使用Canvas绘制验证码
  this.$nextTick(() => {
    this.drawCaptcha();
  });
}

// Canvas绘制验证码
drawCaptcha() {
  const canvas = this.$refs.captchaCanvas;
  const ctx = canvas.getContext('2d');
  const width = canvas.width;
  const height = canvas.height;

  // 清空画布并设置透明背景
  ctx.clearRect(0, 0, width, height);
  ctx.fillStyle = 'rgba(240, 240, 240, 0.3)';
  ctx.fillRect(0, 0, width, height);

  // 绘制验证码文字（随机位置、颜色、旋转）
  ctx.font = 'bold 18px Arial';
  ctx.textAlign = 'center';
  ctx.textBaseline = 'middle';

  for (let i = 0; i < this.captchaCode.length; i++) {
    const char = this.captchaCode[i];
    const x = (width / 4) * (i + 1);
    const y = height / 2 + (Math.random() - 0.5) * 6;

    // 随机颜色和旋转
    const colors = ['#333', '#666', '#999', '#444', '#555'];
    ctx.fillStyle = colors[Math.floor(Math.random() * colors.length)];

    ctx.save();
    ctx.translate(x, y);
    ctx.rotate((Math.random() - 0.5) * 0.3);
    ctx.fillText(char, 0, 0);
    ctx.restore();
  }

  // 绘制干扰线
  for (let i = 0; i < 3; i++) {
    ctx.strokeStyle = `rgba(${Math.floor(Math.random() * 255)}, ${Math.floor(Math.random() * 255)}, ${Math.floor(Math.random() * 255)}, 0.6)`;
    ctx.lineWidth = 1;
    ctx.beginPath();
    ctx.moveTo(Math.random() * width, Math.random() * height);
    ctx.lineTo(Math.random() * width, Math.random() * height);
    ctx.stroke();
  }

  // 绘制干扰点
  for (let i = 0; i < 20; i++) {
    ctx.fillStyle = `rgba(${Math.floor(Math.random() * 255)}, ${Math.floor(Math.random() * 255)}, ${Math.floor(Math.random() * 255)}, 0.4)`;
    ctx.beginPath();
    ctx.arc(Math.random() * width, Math.random() * height, 1, 0, 2 * Math.PI);
    ctx.fill();
  }
}

// 验证码校验
validateCaptcha(rule, value, callback) {
  if (!value) {
    callback(new Error('请输入验证码'));
  } else if (value.toLowerCase() !== this.captchaAnswer) {
    callback(new Error('验证码错误'));
  } else {
    callback();
  }
}
```

### 3. 表单验证规则
```javascript
captcha: [
  { required: true, message: '请输入验证码', trigger: 'blur' },
  { len: 3, message: '验证码长度为3位', trigger: 'blur' },
  { validator: this.validateCaptcha, trigger: 'blur' }
]
```

## 安全特性

1. **防暴力破解**: 每次登录失败都会刷新验证码
2. **字符混淆防护**: 排除了容易混淆的字符
3. **大小写容错**: 提高用户体验的同时保持安全性
4. **自动刷新**: 多种触发条件确保验证码的时效性
5. **视觉干扰**: 通过遮掩线、干扰点、字符变形增加OCR识别难度
6. **随机性增强**: 字符位置、颜色、旋转角度都是随机的
7. **Canvas渲染**: 使用Canvas绘制，比纯文本更难被程序识别

## 用户体验优化

1. **视觉效果**: Canvas绘制的验证码更加美观
2. **透明背景**: 与登录页面背景更好融合
3. **操作便捷**: 多种刷新方式（点击验证码、点击按钮）
4. **错误提示**: 清晰的错误信息指导用户操作
5. **响应式设计**: 适配不同屏幕尺寸
6. **动画效果**: 悬停时的缩放和模糊效果
7. **即时反馈**: 验证码错误时立即刷新

## 测试建议

1. **正确输入测试**: 输入正确的验证码验证功能
2. **错误输入测试**: 输入错误的验证码查看错误处理
3. **大小写测试**: 验证大小写不敏感功能
4. **刷新功能测试**: 测试各种刷新验证码的方式
5. **表单验证测试**: 测试完整的表单验证流程

## 访问地址
- 本地访问: http://localhost:8080/
- 网络访问: http://172.25.219.212:8080/

登录页面现在包含了完整的验证码功能，提供了更好的安全性和用户体验。
