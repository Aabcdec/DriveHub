# 活动照片功能实现说明

## 📋 概述

我已经成功为您的活动管理页面添加了完整的活动照片功能，包括照片上传、显示、预览等功能。

## ✨ 实现的功能

### 1. **📊 活动列表照片显示**

#### 表格列展示
```vue
<el-table-column prop="photos" label="活动照片" width="120">
  <template #default="scope">
    <div v-if="scope.row.photos && scope.row.photos.length > 0" class="photo-preview">
      <el-image
        v-for="(photo, index) in scope.row.photos.slice(0, 2)"
        :key="index"
        :src="photo"
        :preview-src-list="scope.row.photos"
        class="table-photo"
        fit="cover"
      />
      <span v-if="scope.row.photos.length > 2" class="photo-count">
        +{{ scope.row.photos.length - 2 }}
      </span>
    </div>
    <span v-else class="no-photo">暂无照片</span>
  </template>
</el-table-column>
```

**特点**：
- 显示前2张照片缩略图
- 超过2张显示"+N"计数
- 点击可预览所有照片
- 无照片时显示"暂无照片"

### 2. **📝 编辑表单图片上传**

#### 上传组件
```vue
<el-form-item label="活动照片" prop="photos">
  <el-upload
    v-model:file-list="fileList"
    action="#"
    list-type="picture-card"
    :auto-upload="false"
    :on-change="handleFileChange"
    :on-remove="handleFileRemove"
    :before-upload="beforeUpload"
    :limit="3"
    :on-exceed="handleExceed"
    accept="image/*"
  >
    <el-icon><Plus /></el-icon>
    <template #tip>
      <div class="el-upload__tip">
        只能上传jpg/png文件，且不超过2MB，最多3张
      </div>
    </template>
  </el-upload>
</el-form-item>
```

**功能特点**：
- 最多上传3张照片
- 支持JPG/PNG格式
- 文件大小限制2MB
- 拖拽上传支持
- 实时预览功能

### 3. **👁️ 详情对话框照片展示**

#### 详情显示
```vue
<el-descriptions-item label="活动照片" :span="2">
  <div v-if="campaignDetail.photos && campaignDetail.photos.length > 0" class="detail-photos">
    <el-image
      v-for="(photo, index) in campaignDetail.photos"
      :key="index"
      :src="photo"
      :preview-src-list="campaignDetail.photos"
      class="detail-photo"
      fit="cover"
    />
  </div>
  <span v-else>暂无照片</span>
</el-descriptions-item>
```

**特点**：
- 显示所有活动照片
- 支持点击放大预览
- 照片网格布局
- 响应式设计

## 🔧 技术实现

### 1. **数据结构扩展**

#### campaignForm 数据结构
```javascript
campaignForm: {
  id: '',
  ownerId: '',
  cost: '',
  name: '',
  description: '',
  startTime: '',
  createBy: '',
  createTime: '',
  editBy: '',
  endTime: '',
  editTime: '',
  status: '1',
  activeType: '线上推广',
  photos: [] // 新增照片数组
}
```

#### 文件列表管理
```javascript
data() {
  return {
    fileList: [], // 图片上传文件列表
    // 其他数据...
  }
}
```

### 2. **图片上传处理方法**

#### 文件变化处理
```javascript
handleFileChange(file, fileList) {
  console.log('文件变化:', file, fileList)
  this.fileList = fileList
  this.uploadFiles()
}
```

#### 文件移除处理
```javascript
handleFileRemove(file, fileList) {
  console.log('文件移除:', file, fileList)
  this.fileList = fileList
  
  const index = this.campaignForm.photos.findIndex(photo => photo === file.url)
  if (index > -1) {
    this.campaignForm.photos.splice(index, 1)
  }
}
```

#### 上传前验证
```javascript
beforeUpload(file) {
  const isJPG = file.type === 'image/jpeg' || file.type === 'image/png'
  const isLt2M = file.size / 1024 / 1024 < 2

  if (!isJPG) {
    ElMessage.error('上传图片只能是 JPG/PNG 格式!')
    return false
  }
  if (!isLt2M) {
    ElMessage.error('上传图片大小不能超过 2MB!')
    return false
  }
  return false // 阻止自动上传
}
```

#### 文件转Base64
```javascript
async uploadFiles() {
  const photos = []
  
  for (const file of this.fileList) {
    if (file.raw) {
      const base64 = await this.fileToBase64(file.raw)
      photos.push(base64)
    } else if (file.url) {
      photos.push(file.url)
    }
  }
  
  this.campaignForm.photos = photos
}

fileToBase64(file) {
  return new Promise((resolve, reject) => {
    const reader = new FileReader()
    reader.readAsDataURL(file)
    reader.onload = () => resolve(reader.result)
    reader.onerror = error => reject(error)
  })
}
```

### 3. **数据回显处理**

#### 编辑时照片回显
```javascript
editCampaign(campaign) {
  // 数据回显
  this.campaignForm = {
    // 其他字段...
    photos: campaign.photos || []
  }
  
  // 文件列表回显
  if (campaign.photos && campaign.photos.length > 0) {
    this.fileList = campaign.photos.map((photo, index) => ({
      uid: index,
      name: `photo-${index}.jpg`,
      status: 'success',
      url: photo
    }))
  } else {
    this.fileList = []
  }
}
```

#### 数据加载处理
```javascript
loadCampaigns() {
  this.campaigns = res.map(item => ({
    // 其他字段...
    photos: item.photos ? 
      (typeof item.photos === 'string' ? JSON.parse(item.photos) : item.photos) : 
      []
  }))
}
```

## 🎨 样式设计

### 1. **表格照片样式**
```css
.photo-preview {
  display: flex;
  align-items: center;
  gap: 4px;
}

.table-photo {
  width: 40px;
  height: 40px;
  border-radius: 4px;
  cursor: pointer;
}

.photo-count {
  font-size: 12px;
  color: #909399;
  background: #f5f7fa;
  padding: 2px 6px;
  border-radius: 10px;
}
```

### 2. **详情页照片样式**
```css
.detail-photos {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
}

.detail-photo {
  width: 80px;
  height: 80px;
  border-radius: 6px;
  cursor: pointer;
}
```

### 3. **上传组件样式**
```css
.el-upload--picture-card {
  width: 80px;
  height: 80px;
}

.el-upload-list--picture-card .el-upload-list__item {
  width: 80px;
  height: 80px;
}
```

## 📊 数据流程

### 1. **新增活动流程**
```
选择照片 → 文件验证 → 转换Base64 → 保存到photos数组 → 提交表单 → 保存到数据库
```

### 2. **编辑活动流程**
```
加载活动数据 → 解析photos字段 → 回显到fileList → 修改照片 → 更新photos数组 → 提交保存
```

### 3. **查看活动流程**
```
加载活动列表 → 解析photos字段 → 显示缩略图 → 点击预览 → 大图展示
```

## 🔍 功能特点

### ✅ **完整的照片管理**
1. **上传功能**: 支持多张照片上传，最多3张
2. **格式验证**: 仅支持JPG/PNG格式
3. **大小限制**: 单个文件不超过2MB
4. **实时预览**: 上传后立即显示预览

### ✅ **优秀的用户体验**
1. **拖拽上传**: 支持拖拽文件上传
2. **进度显示**: 上传过程可视化
3. **错误提示**: 详细的错误信息提示
4. **响应式设计**: 适配不同屏幕尺寸

### ✅ **数据安全性**
1. **前端验证**: 文件类型和大小验证
2. **Base64编码**: 安全的数据传输方式
3. **错误处理**: 完善的异常处理机制

## 🎯 使用说明

### 1. **上传照片**
- 在新增/编辑活动时，点击照片上传区域
- 选择JPG/PNG格式的图片文件
- 确保文件大小不超过2MB
- 最多可上传3张照片

### 2. **查看照片**
- 在活动列表中直接查看缩略图
- 点击照片可放大预览
- 在详情页面查看所有照片

### 3. **管理照片**
- 编辑活动时可添加/删除照片
- 支持重新排序照片
- 保存时自动更新照片数据

现在您的活动管理页面拥有了完整的照片管理功能，提升了活动信息的丰富度和可视化效果！
