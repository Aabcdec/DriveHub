# æ´»åŠ¨ç®¡ç†æ•°æ®å›æ˜¾åŠŸèƒ½å®ç°è¯´æ˜

## ğŸ“‹ æ¦‚è¿°

æˆ‘å·²ç»ä¸ºæ‚¨çš„æ´»åŠ¨ç®¡ç†é¡µé¢å®ç°äº†å®Œæ•´çš„æ•°æ®å›æ˜¾åŠŸèƒ½ï¼Œç¡®ä¿åœ¨ç¼–è¾‘æ¨¡å¼ä¸‹æ‰€æœ‰å­—æ®µéƒ½èƒ½æ­£ç¡®å›æ˜¾ï¼Œè€Œåœ¨æ–°å¢æ¨¡å¼ä¸‹æ‰€æœ‰å­—æ®µéƒ½ä¸ºç©ºã€‚

## âœ¨ å®ç°çš„åŠŸèƒ½

### 1. **ğŸ”„ å®Œæ•´çš„æ•°æ®å›æ˜¾**
- **ç¼–è¾‘æ¨¡å¼**: æ‰€æœ‰è¡¨å•å­—æ®µéƒ½ä¼šå›æ˜¾åŸæœ‰æ•°æ®
- **æ–°å¢æ¨¡å¼**: æ‰€æœ‰è¡¨å•å­—æ®µéƒ½ä¸ºç©º
- **æŸ¥çœ‹è½¬ç¼–è¾‘**: ä»è¯¦æƒ…é¡µé¢ç‚¹å‡»ç¼–è¾‘ä¹Ÿèƒ½æ­£ç¡®å›æ˜¾

### 2. **ğŸ“ æ”¯æŒçš„å­—æ®µå›æ˜¾**
```javascript
campaignForm: {
  id: '',              // æ´»åŠ¨ID
  ownerId: '',         // æ´»åŠ¨æ‰€å±ID
  cost: '',            // æ´»åŠ¨é¢„ç®—
  name: '',            // æ´»åŠ¨åç§°
  description: '',     // æ´»åŠ¨æè¿°
  startTime: '',       // å¼€å§‹æ—¶é—´
  createBy: '',        // åˆ›å»ºäºº
  createTime: '',      // åˆ›å»ºæ—¶é—´
  editBy: '',          // ç¼–è¾‘äºº
  endTime: '',         // ç»“æŸæ—¶é—´
  editTime: ''         // ç¼–è¾‘æ—¶é—´
}
```

### 3. **â° æ—¶é—´èŒƒå›´å¤„ç†**
- **æ—¶é—´èŒƒå›´é€‰æ‹©å™¨**: `StartEndTime` æ•°ç»„
- **ç¼–è¾‘å›æ˜¾**: è‡ªåŠ¨å¡«å……å¼€å§‹å’Œç»“æŸæ—¶é—´
- **æ–°å¢æ¸…ç©º**: æ—¶é—´èŒƒå›´é€‰æ‹©å™¨ä¸ºç©ºæ•°ç»„

## ğŸ”§ æ ¸å¿ƒå®ç°

### 1. **æ–°å¢æ´»åŠ¨æ–¹æ³•**
```javascript
addCampaign() {
  // é‡ç½®è¡¨å•ä¸ºç©º
  this.editingCampaign = null
  this.campaignForm = {
    id: '',
    ownerId: '',
    cost: '',
    name: '',
    description: '',
    startTime: '',
    createBy: '',
    createTime: '',
    editBy: '',
    endTime: '',
    editTime: ''
  }
  
  // é‡ç½®æ—¶é—´èŒƒå›´é€‰æ‹©å™¨
  this.StartEndTime = []
  
  // æ¸…é™¤è¡¨å•éªŒè¯
  this.$nextTick(() => {
    if (this.$refs.campaignFormRef) {
      this.$refs.campaignFormRef.clearValidate()
    }
  })
  
  this.showAddDialog = true
}
```

### 2. **ç¼–è¾‘æ´»åŠ¨æ–¹æ³•**
```javascript
editCampaign(campaign) {
  this.editingCampaign = campaign
  
  // å®Œæ•´çš„æ•°æ®å›æ˜¾
  this.campaignForm = {
    id: campaign.id || '',
    ownerId: campaign.ownerId || '',
    cost: campaign.cost || '',
    name: campaign.name || '',
    description: campaign.description || '',
    startTime: campaign.startTime || '',
    createBy: campaign.createBy || '',
    createTime: campaign.createTime || '',
    editBy: campaign.editBy || '',
    endTime: campaign.endTime || '',
    editTime: campaign.editTime || ''
  }
  
  // å¤„ç†æ—¶é—´èŒƒå›´é€‰æ‹©å™¨çš„æ•°æ®å›æ˜¾
  if (campaign.startTime && campaign.endTime) {
    this.StartEndTime = [campaign.startTime, campaign.endTime]
  } else {
    this.StartEndTime = []
  }
  
  this.showAddDialog = true
}
```

### 3. **ä¿å­˜æ–¹æ³•ä¼˜åŒ–**
```javascript
saveCampaign() {
  this.$refs.campaignFormRef.validate((valid) => {
    if (valid) {
      // å¤„ç†æ—¶é—´èŒƒå›´æ•°æ®
      let startTime = this.campaignForm.startTime
      let endTime = this.campaignForm.endTime
      
      if (this.StartEndTime && this.StartEndTime.length === 2) {
        startTime = this.StartEndTime[0]
        endTime = this.StartEndTime[1]
      }
      
      const data = {
        ...this.campaignForm,
        startTime: startTime,
        endTime: endTime,
        // å…¶ä»–å­—æ®µ...
      }
      
      // æ ¹æ®æ˜¯å¦æœ‰editingCampaignåˆ¤æ–­æ˜¯æ–°å¢è¿˜æ˜¯ç¼–è¾‘
      const request = this.editingCampaign 
        ? doPut('/api/market/campaigns/' + this.editingCampaign.id, data)
        : doPost('/api/market/campaigns', data)
    }
  })
}
```

### 4. **é‡ç½®è¡¨å•æ–¹æ³•**
```javascript
resetForm() {
  this.campaignForm = {
    id: '',
    ownerId: '',
    cost: '',
    name: '',
    description: '',
    startTime: '',
    createBy: '',
    createTime: '',
    editBy: '',
    endTime: '',
    editTime: ''
  }
  
  // é‡ç½®æ—¶é—´èŒƒå›´é€‰æ‹©å™¨
  this.StartEndTime = []
  
  this.editingCampaign = null
  if (this.$refs.campaignFormRef) {
    this.$refs.campaignFormRef.clearValidate()
  }
}
```

## ğŸ¯ ä½¿ç”¨åœºæ™¯

### 1. **æ–°å¢æ´»åŠ¨**
1. ç‚¹å‡»"æ–°å¢æ´»åŠ¨è®°å½•"æŒ‰é’®
2. è¡¨å•æ‰€æœ‰å­—æ®µä¸ºç©º
3. æ—¶é—´èŒƒå›´é€‰æ‹©å™¨ä¸ºç©º
4. å¡«å†™ä¿¡æ¯åä¿å­˜

### 2. **ç›´æ¥ç¼–è¾‘**
1. ç‚¹å‡»è¡¨æ ¼ä¸­çš„"ç¼–è¾‘"æŒ‰é’®
2. è¡¨å•è‡ªåŠ¨å›æ˜¾æ‰€æœ‰å­—æ®µæ•°æ®
3. æ—¶é—´èŒƒå›´é€‰æ‹©å™¨æ˜¾ç¤ºåŸæœ‰æ—¶é—´èŒƒå›´
4. ä¿®æ”¹ä¿¡æ¯åä¿å­˜

### 3. **æŸ¥çœ‹åç¼–è¾‘**
1. ç‚¹å‡»è¡¨æ ¼ä¸­çš„"æŸ¥çœ‹"æŒ‰é’®
2. åœ¨è¯¦æƒ…å¯¹è¯æ¡†ä¸­ç‚¹å‡»"ç¼–è¾‘"æŒ‰é’®
3. è¡¨å•è‡ªåŠ¨å›æ˜¾æ‰€æœ‰å­—æ®µæ•°æ®
4. ä¿®æ”¹ä¿¡æ¯åä¿å­˜

## ğŸ” å¯¹è¯æ¡†æ ‡é¢˜åŠ¨æ€æ˜¾ç¤º

```vue
<el-dialog 
  v-model="showAddDialog" 
  :title="editingCampaign ? 'ç¼–è¾‘æ´»åŠ¨è®°å½•' : 'æ–°å¢æ´»åŠ¨è®°å½•'" 
  width="700px"
>
```

- **æ–°å¢æ¨¡å¼**: æ˜¾ç¤º"æ–°å¢æ´»åŠ¨è®°å½•"
- **ç¼–è¾‘æ¨¡å¼**: æ˜¾ç¤º"ç¼–è¾‘æ´»åŠ¨è®°å½•"

## ğŸ“Š æ•°æ®æµç¨‹

### æ–°å¢æµç¨‹
```
ç‚¹å‡»æ–°å¢æŒ‰é’® â†’ addCampaign() â†’ æ¸…ç©ºè¡¨å• â†’ æ˜¾ç¤ºå¯¹è¯æ¡† â†’ å¡«å†™æ•°æ® â†’ saveCampaign() â†’ POSTè¯·æ±‚
```

### ç¼–è¾‘æµç¨‹
```
ç‚¹å‡»ç¼–è¾‘æŒ‰é’® â†’ editCampaign() â†’ å›æ˜¾æ•°æ® â†’ æ˜¾ç¤ºå¯¹è¯æ¡† â†’ ä¿®æ”¹æ•°æ® â†’ saveCampaign() â†’ PUTè¯·æ±‚
```

### æŸ¥çœ‹è½¬ç¼–è¾‘æµç¨‹
```
ç‚¹å‡»æŸ¥çœ‹æŒ‰é’® â†’ viewCampaign() â†’ æ˜¾ç¤ºè¯¦æƒ… â†’ ç‚¹å‡»ç¼–è¾‘ â†’ editFromDetail() â†’ editCampaign() â†’ å›æ˜¾æ•°æ®
```

## âš¡ æ€§èƒ½ä¼˜åŒ–

### 1. **è¡¨å•éªŒè¯æ¸…é™¤**
```javascript
this.$nextTick(() => {
  if (this.$refs.campaignFormRef) {
    this.$refs.campaignFormRef.clearValidate()
  }
})
```

### 2. **æ•°æ®å®‰å…¨å¤„ç†**
```javascript
// ä½¿ç”¨ || '' ç¡®ä¿å­—æ®µä¸ä¸ºundefinedæˆ–null
id: campaign.id || '',
name: campaign.name || '',
```

### 3. **æ—¶é—´æ•°æ®å¤„ç†**
```javascript
// å®‰å…¨çš„æ—¶é—´èŒƒå›´å¤„ç†
if (campaign.startTime && campaign.endTime) {
  this.StartEndTime = [campaign.startTime, campaign.endTime]
} else {
  this.StartEndTime = []
}
```

## ğŸ‰ åŠŸèƒ½ç‰¹ç‚¹

1. **âœ… å®Œæ•´æ•°æ®å›æ˜¾**: æ‰€æœ‰è¡¨å•å­—æ®µéƒ½èƒ½æ­£ç¡®å›æ˜¾
2. **âœ… æ™ºèƒ½æ¨¡å¼åˆ‡æ¢**: è‡ªåŠ¨è¯†åˆ«æ–°å¢å’Œç¼–è¾‘æ¨¡å¼
3. **âœ… æ—¶é—´èŒƒå›´æ”¯æŒ**: æ­£ç¡®å¤„ç†æ—¶é—´èŒƒå›´é€‰æ‹©å™¨
4. **âœ… è¡¨å•éªŒè¯æ¸…é™¤**: é¿å…éªŒè¯é”™è¯¯æ®‹ç•™
5. **âœ… æ•°æ®å®‰å…¨å¤„ç†**: é˜²æ­¢undefinedå’Œnullå€¼
6. **âœ… ç”¨æˆ·ä½“éªŒä¼˜åŒ–**: æ¸…æ™°çš„å¯¹è¯æ¡†æ ‡é¢˜å’Œæ“ä½œæµç¨‹

ç°åœ¨æ‚¨çš„æ´»åŠ¨ç®¡ç†é¡µé¢æ‹¥æœ‰äº†å®Œæ•´çš„æ•°æ®å›æ˜¾åŠŸèƒ½ï¼Œæ— è®ºæ˜¯æ–°å¢ã€ç¼–è¾‘è¿˜æ˜¯æŸ¥çœ‹è½¬ç¼–è¾‘ï¼Œéƒ½èƒ½æä¾›æœ€ä½³çš„ç”¨æˆ·ä½“éªŒï¼
