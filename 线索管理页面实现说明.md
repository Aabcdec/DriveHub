# 线索管理页面实现说明

## 📋 概述

我已经根据您提供的数据库表结构，完整实现了线索管理页面，包含了所有数据库字段的管理功能。

## 🗃️ 数据库表结构对应

### 表字段映射
| 数据库字段 | 中文名称 | 字段类型 | 说明 |
|------------|----------|----------|------|
| `id` | 线索ID | int(11) | 主键，自动递增 |
| `owner_id` | 线索所属人ID | int(11) | 负责人ID |
| `activity_id` | 活动ID | int(11) | 关联的活动ID |
| `full_name` | 姓名 | varchar(64) | 客户姓名 |
| `appellation` | 称呼 | int(11) | 称呼方式 |
| `phone` | 手机号 | varchar(18) | 联系电话 |
| `weixin` | 微信号 | varchar(128) | 微信联系方式 |
| `qq` | QQ号 | varchar(20) | QQ联系方式 |
| `email` | 邮箱 | varchar(128) | 邮箱地址 |
| `age` | 年龄 | int(11) | 客户年龄 |
| `job` | 职业 | varchar(64) | 职业信息 |
| `year_income` | 年收入 | decimal(10,2) | 年收入金额 |
| `address` | 地址 | varchar(128) | 联系地址 |
| `need_loan` | 是否需要贷款 | int(11) | 贷款需求 |
| `intention_state` | 意向状态 | int(11) | 客户意向程度 |
| `intention_product` | 意向产品 | int(11) | 感兴趣的产品 |
| `state` | 线索状态 | int(11) | 线索处理状态 |
| `source` | 线索来源 | int(11) | 线索获取渠道 |
| `description` | 线索描述 | varchar(255) | 详细描述 |
| `next_contact_time` | 下次联系时间 | datetime | 计划联系时间 |
| `create_time` | 创建时间 | datetime | 记录创建时间 |
| `create_by` | 创建人 | int(11) | 创建人ID |
| `edit_time` | 编辑时间 | datetime | 最后编辑时间 |
| `edit_by` | 编辑人 | int(11) | 编辑人ID |

## ✨ 实现的核心功能

### 1. **📊 线索列表展示**

#### 表格列设计
```vue
<el-table :data="leads" style="width: 100%" v-loading="loading">
  <el-table-column prop="id" label="线索ID" width="80" />
  <el-table-column prop="full_name" label="姓名" width="100" />
  <el-table-column prop="phone" label="手机号" width="120" />
  <el-table-column prop="weixin" label="微信号" width="120" />
  <el-table-column prop="email" label="邮箱" width="150" show-overflow-tooltip />
  <el-table-column prop="age" label="年龄" width="80" />
  <el-table-column prop="job" label="职业" width="100" />
  <el-table-column prop="year_income" label="年收入" width="100">
    <template #default="scope">
      <span v-if="scope.row.year_income">¥{{ Number(scope.row.year_income).toLocaleString() }}</span>
      <span v-else>-</span>
    </template>
  </el-table-column>
  <el-table-column prop="intention_state" label="意向状态" width="100">
    <template #default="scope">
      <el-tag :type="getIntentionColor(scope.row.intention_state)">
        {{ getIntentionLabel(scope.row.intention_state) }}
      </el-tag>
    </template>
  </el-table-column>
  <!-- 更多列... -->
</el-table>
```

### 2. **🔍 搜索和筛选功能**

#### 搜索表单
```vue
<el-form :model="searchForm" :inline="true">
  <el-form-item label="姓名">
    <el-input v-model="searchForm.full_name" placeholder="请输入姓名" clearable />
  </el-form-item>
  <el-form-item label="手机号">
    <el-input v-model="searchForm.phone" placeholder="请输入手机号" clearable />
  </el-form-item>
  <el-form-item label="意向状态">
    <el-select v-model="searchForm.intention_state" placeholder="请选择意向状态" clearable>
      <el-option label="初步意向" :value="1" />
      <el-option label="强烈意向" :value="2" />
      <el-option label="已成交" :value="3" />
      <el-option label="已放弃" :value="4" />
    </el-select>
  </el-form-item>
  <el-form-item label="线索来源">
    <el-select v-model="searchForm.source" placeholder="请选择线索来源" clearable>
      <el-option label="网站咨询" :value="1" />
      <el-option label="电话咨询" :value="2" />
      <el-option label="朋友推荐" :value="3" />
      <el-option label="广告投放" :value="4" />
      <el-option label="其他" :value="5" />
    </el-select>
  </el-form-item>
</el-form>
```

### 3. **📝 新增/编辑线索表单**

#### 完整表单设计
```vue
<el-form ref="leadFormRef" :model="leadForm" :rules="leadRules" label-width="100px">
  <!-- 基本信息 -->
  <el-row :gutter="20">
    <el-col :span="12">
      <el-form-item label="姓名" prop="full_name">
        <el-input v-model="leadForm.full_name" placeholder="请输入姓名" />
      </el-form-item>
    </el-col>
    <el-col :span="12">
      <el-form-item label="手机号" prop="phone">
        <el-input v-model="leadForm.phone" placeholder="请输入手机号" />
      </el-form-item>
    </el-col>
  </el-row>
  
  <!-- 联系方式 -->
  <el-row :gutter="20">
    <el-col :span="12">
      <el-form-item label="微信号" prop="weixin">
        <el-input v-model="leadForm.weixin" placeholder="请输入微信号" />
      </el-form-item>
    </el-col>
    <el-col :span="12">
      <el-form-item label="QQ号" prop="qq">
        <el-input v-model="leadForm.qq" placeholder="请输入QQ号" />
      </el-form-item>
    </el-col>
  </el-row>

  <!-- 个人信息 -->
  <el-row :gutter="20">
    <el-col :span="12">
      <el-form-item label="年龄" prop="age">
        <el-input-number v-model="leadForm.age" :min="1" :max="120" />
      </el-form-item>
    </el-col>
    <el-col :span="12">
      <el-form-item label="年收入" prop="year_income">
        <el-input-number v-model="leadForm.year_income" :min="0" />
      </el-form-item>
    </el-col>
  </el-row>

  <!-- 意向信息 -->
  <el-row :gutter="20">
    <el-col :span="12">
      <el-form-item label="意向状态" prop="intention_state">
        <el-select v-model="leadForm.intention_state">
          <el-option label="初步意向" :value="1" />
          <el-option label="强烈意向" :value="2" />
          <el-option label="已成交" :value="3" />
          <el-option label="已放弃" :value="4" />
        </el-select>
      </el-form-item>
    </el-col>
    <el-col :span="12">
      <el-form-item label="线索来源" prop="source">
        <el-select v-model="leadForm.source">
          <el-option label="网站咨询" :value="1" />
          <el-option label="电话咨询" :value="2" />
          <el-option label="朋友推荐" :value="3" />
          <el-option label="广告投放" :value="4" />
          <el-option label="其他" :value="5" />
        </el-select>
      </el-form-item>
    </el-col>
  </el-row>

  <!-- 其他信息 -->
  <el-form-item label="线索描述" prop="description">
    <el-input v-model="leadForm.description" type="textarea" :rows="4" />
  </el-form-item>
  
  <el-form-item label="下次联系时间" prop="next_contact_time">
    <el-date-picker
      v-model="leadForm.next_contact_time"
      type="datetime"
      placeholder="选择下次联系时间"
    />
  </el-form-item>
</el-form>
```

### 4. **👁️ 线索详情查看**

#### 详情展示
```vue
<el-descriptions :column="2" border>
  <el-descriptions-item label="线索ID">{{ leadDetail.id }}</el-descriptions-item>
  <el-descriptions-item label="姓名">{{ leadDetail.full_name || '-' }}</el-descriptions-item>
  <el-descriptions-item label="手机号">{{ leadDetail.phone || '-' }}</el-descriptions-item>
  <el-descriptions-item label="年收入">
    <span v-if="leadDetail.year_income">¥{{ Number(leadDetail.year_income).toLocaleString() }}</span>
    <span v-else>-</span>
  </el-descriptions-item>
  <el-descriptions-item label="意向状态">
    <el-tag :type="getIntentionColor(leadDetail.intention_state)">
      {{ getIntentionLabel(leadDetail.intention_state) }}
    </el-tag>
  </el-descriptions-item>
  <!-- 更多字段... -->
</el-descriptions>
```

## 🔧 核心方法实现

### 1. **数据加载方法**
```javascript
async loadLeads() {
  this.loading = true
  try {
    const res = await fetchPageData(this.currentPage, this.pageSize, '/api/leads', '线索信息获取失败')
    
    if (Array.isArray(res)) {
      this.leads = res.map(item => ({
        id: item.id || '',
        owner_id: item.owner_id || '',
        activity_id: item.activity_id || '',
        full_name: item.full_name || '',
        // 映射所有数据库字段...
      }))
    }
  } catch (error) {
    ElMessage.error('加载线索数据失败')
  }
  this.loading = false
}
```

### 2. **状态标签方法**
```javascript
// 获取意向状态颜色
getIntentionColor(state) {
  const colors = {
    1: 'info',      // 初步意向
    2: 'warning',   // 强烈意向
    3: 'success',   // 已成交
    4: 'danger'     // 已放弃
  }
  return colors[state] || 'info'
}

// 获取意向状态标签
getIntentionLabel(state) {
  const labels = {
    1: '初步意向',
    2: '强烈意向',
    3: '已成交',
    4: '已放弃'
  }
  return labels[state] || '初步意向'
}
```

### 3. **CRUD操作方法**
```javascript
// 保存线索
saveLead() {
  this.$refs.leadFormRef.validate((valid) => {
    if (valid) {
      const data = {
        ...this.leadForm,
        create_time: new Date().toISOString().slice(0, 19).replace('T', ' '),
        create_by: 1,
        edit_time: new Date().toISOString().slice(0, 19).replace('T', ' '),
        edit_by: 1
      }

      const request = this.editingLead 
        ? doPut('/api/leads/' + this.editingLead.id, data)
        : doPost('/api/leads', data)

      request.then(res => {
        if (res.data && res.data.code === 200) {
          ElMessage.success(this.editingLead ? '线索更新成功' : '线索创建成功')
          this.showAddDialog = false
          this.loadLeads()
        }
      })
    }
  })
}
```

## 📊 数据验证规则

### 表单验证
```javascript
leadRules: {
  full_name: [
    { required: true, message: '请输入姓名', trigger: 'blur' }
  ],
  phone: [
    { required: true, message: '请输入手机号', trigger: 'blur' },
    { pattern: /^1[3-9]\d{9}$/, message: '请输入正确的手机号', trigger: 'blur' }
  ],
  intention_state: [
    { required: true, message: '请选择意向状态', trigger: 'change' }
  ],
  source: [
    { required: true, message: '请选择线索来源', trigger: 'change' }
  ]
}
```

## 🎯 功能特点

### ✅ **完整的数据库字段支持**
1. **基本信息**: 姓名、手机号、微信、QQ、邮箱
2. **个人信息**: 年龄、职业、年收入、地址
3. **业务信息**: 意向状态、意向产品、线索来源、线索状态
4. **跟进信息**: 线索描述、下次联系时间
5. **系统信息**: 创建时间、编辑时间、创建人、编辑人

### ✅ **用户体验优化**
1. **搜索筛选**: 支持姓名、手机号、意向状态、线索来源筛选
2. **状态标签**: 彩色标签显示意向状态
3. **金额格式化**: 年收入显示千分位分隔符
4. **时间格式化**: 统一的时间显示格式
5. **分页功能**: 支持分页浏览和页面大小调整

### ✅ **数据安全性**
1. **表单验证**: 必填字段和格式验证
2. **手机号验证**: 正则表达式验证手机号格式
3. **数据映射**: 安全的数据字段映射
4. **错误处理**: 完善的错误提示和异常处理

现在您拥有了一个完整的线索管理页面，完全对应数据库表结构，支持所有字段的管理和操作！
