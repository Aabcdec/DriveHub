# çº¿ç´¢ç®¡ç†é¡µé¢å®ç°è¯´æ˜

## ğŸ“‹ æ¦‚è¿°

æˆ‘å·²ç»æ ¹æ®æ‚¨æä¾›çš„æ•°æ®åº“è¡¨ç»“æ„ï¼Œå®Œæ•´å®ç°äº†çº¿ç´¢ç®¡ç†é¡µé¢ï¼ŒåŒ…å«äº†æ‰€æœ‰æ•°æ®åº“å­—æ®µçš„ç®¡ç†åŠŸèƒ½ã€‚

## ğŸ—ƒï¸ æ•°æ®åº“è¡¨ç»“æ„å¯¹åº”

### è¡¨å­—æ®µæ˜ å°„
| æ•°æ®åº“å­—æ®µ | ä¸­æ–‡åç§° | å­—æ®µç±»å‹ | è¯´æ˜ |
|------------|----------|----------|------|
| `id` | çº¿ç´¢ID | int(11) | ä¸»é”®ï¼Œè‡ªåŠ¨é€’å¢ |
| `owner_id` | çº¿ç´¢æ‰€å±äººID | int(11) | è´Ÿè´£äººID |
| `activity_id` | æ´»åŠ¨ID | int(11) | å…³è”çš„æ´»åŠ¨ID |
| `full_name` | å§“å | varchar(64) | å®¢æˆ·å§“å |
| `appellation` | ç§°å‘¼ | int(11) | ç§°å‘¼æ–¹å¼ |
| `phone` | æ‰‹æœºå· | varchar(18) | è”ç³»ç”µè¯ |
| `weixin` | å¾®ä¿¡å· | varchar(128) | å¾®ä¿¡è”ç³»æ–¹å¼ |
| `qq` | QQå· | varchar(20) | QQè”ç³»æ–¹å¼ |
| `email` | é‚®ç®± | varchar(128) | é‚®ç®±åœ°å€ |
| `age` | å¹´é¾„ | int(11) | å®¢æˆ·å¹´é¾„ |
| `job` | èŒä¸š | varchar(64) | èŒä¸šä¿¡æ¯ |
| `year_income` | å¹´æ”¶å…¥ | decimal(10,2) | å¹´æ”¶å…¥é‡‘é¢ |
| `address` | åœ°å€ | varchar(128) | è”ç³»åœ°å€ |
| `need_loan` | æ˜¯å¦éœ€è¦è´·æ¬¾ | int(11) | è´·æ¬¾éœ€æ±‚ |
| `intention_state` | æ„å‘çŠ¶æ€ | int(11) | å®¢æˆ·æ„å‘ç¨‹åº¦ |
| `intention_product` | æ„å‘äº§å“ | int(11) | æ„Ÿå…´è¶£çš„äº§å“ |
| `state` | çº¿ç´¢çŠ¶æ€ | int(11) | çº¿ç´¢å¤„ç†çŠ¶æ€ |
| `source` | çº¿ç´¢æ¥æº | int(11) | çº¿ç´¢è·å–æ¸ é“ |
| `description` | çº¿ç´¢æè¿° | varchar(255) | è¯¦ç»†æè¿° |
| `next_contact_time` | ä¸‹æ¬¡è”ç³»æ—¶é—´ | datetime | è®¡åˆ’è”ç³»æ—¶é—´ |
| `create_time` | åˆ›å»ºæ—¶é—´ | datetime | è®°å½•åˆ›å»ºæ—¶é—´ |
| `create_by` | åˆ›å»ºäºº | int(11) | åˆ›å»ºäººID |
| `edit_time` | ç¼–è¾‘æ—¶é—´ | datetime | æœ€åç¼–è¾‘æ—¶é—´ |
| `edit_by` | ç¼–è¾‘äºº | int(11) | ç¼–è¾‘äººID |

## âœ¨ å®ç°çš„æ ¸å¿ƒåŠŸèƒ½

### 1. **ğŸ“Š çº¿ç´¢åˆ—è¡¨å±•ç¤º**

#### è¡¨æ ¼åˆ—è®¾è®¡
```vue
<el-table :data="leads" style="width: 100%" v-loading="loading">
  <el-table-column prop="id" label="çº¿ç´¢ID" width="80" />
  <el-table-column prop="full_name" label="å§“å" width="100" />
  <el-table-column prop="phone" label="æ‰‹æœºå·" width="120" />
  <el-table-column prop="weixin" label="å¾®ä¿¡å·" width="120" />
  <el-table-column prop="email" label="é‚®ç®±" width="150" show-overflow-tooltip />
  <el-table-column prop="age" label="å¹´é¾„" width="80" />
  <el-table-column prop="job" label="èŒä¸š" width="100" />
  <el-table-column prop="year_income" label="å¹´æ”¶å…¥" width="100">
    <template #default="scope">
      <span v-if="scope.row.year_income">Â¥{{ Number(scope.row.year_income).toLocaleString() }}</span>
      <span v-else>-</span>
    </template>
  </el-table-column>
  <el-table-column prop="intention_state" label="æ„å‘çŠ¶æ€" width="100">
    <template #default="scope">
      <el-tag :type="getIntentionColor(scope.row.intention_state)">
        {{ getIntentionLabel(scope.row.intention_state) }}
      </el-tag>
    </template>
  </el-table-column>
  <!-- æ›´å¤šåˆ—... -->
</el-table>
```

### 2. **ğŸ” æœç´¢å’Œç­›é€‰åŠŸèƒ½**

#### æœç´¢è¡¨å•
```vue
<el-form :model="searchForm" :inline="true">
  <el-form-item label="å§“å">
    <el-input v-model="searchForm.full_name" placeholder="è¯·è¾“å…¥å§“å" clearable />
  </el-form-item>
  <el-form-item label="æ‰‹æœºå·">
    <el-input v-model="searchForm.phone" placeholder="è¯·è¾“å…¥æ‰‹æœºå·" clearable />
  </el-form-item>
  <el-form-item label="æ„å‘çŠ¶æ€">
    <el-select v-model="searchForm.intention_state" placeholder="è¯·é€‰æ‹©æ„å‘çŠ¶æ€" clearable>
      <el-option label="åˆæ­¥æ„å‘" :value="1" />
      <el-option label="å¼ºçƒˆæ„å‘" :value="2" />
      <el-option label="å·²æˆäº¤" :value="3" />
      <el-option label="å·²æ”¾å¼ƒ" :value="4" />
    </el-select>
  </el-form-item>
  <el-form-item label="çº¿ç´¢æ¥æº">
    <el-select v-model="searchForm.source" placeholder="è¯·é€‰æ‹©çº¿ç´¢æ¥æº" clearable>
      <el-option label="ç½‘ç«™å’¨è¯¢" :value="1" />
      <el-option label="ç”µè¯å’¨è¯¢" :value="2" />
      <el-option label="æœ‹å‹æ¨è" :value="3" />
      <el-option label="å¹¿å‘ŠæŠ•æ”¾" :value="4" />
      <el-option label="å…¶ä»–" :value="5" />
    </el-select>
  </el-form-item>
</el-form>
```

### 3. **ğŸ“ æ–°å¢/ç¼–è¾‘çº¿ç´¢è¡¨å•**

#### å®Œæ•´è¡¨å•è®¾è®¡
```vue
<el-form ref="leadFormRef" :model="leadForm" :rules="leadRules" label-width="100px">
  <!-- åŸºæœ¬ä¿¡æ¯ -->
  <el-row :gutter="20">
    <el-col :span="12">
      <el-form-item label="å§“å" prop="full_name">
        <el-input v-model="leadForm.full_name" placeholder="è¯·è¾“å…¥å§“å" />
      </el-form-item>
    </el-col>
    <el-col :span="12">
      <el-form-item label="æ‰‹æœºå·" prop="phone">
        <el-input v-model="leadForm.phone" placeholder="è¯·è¾“å…¥æ‰‹æœºå·" />
      </el-form-item>
    </el-col>
  </el-row>
  
  <!-- è”ç³»æ–¹å¼ -->
  <el-row :gutter="20">
    <el-col :span="12">
      <el-form-item label="å¾®ä¿¡å·" prop="weixin">
        <el-input v-model="leadForm.weixin" placeholder="è¯·è¾“å…¥å¾®ä¿¡å·" />
      </el-form-item>
    </el-col>
    <el-col :span="12">
      <el-form-item label="QQå·" prop="qq">
        <el-input v-model="leadForm.qq" placeholder="è¯·è¾“å…¥QQå·" />
      </el-form-item>
    </el-col>
  </el-row>

  <!-- ä¸ªäººä¿¡æ¯ -->
  <el-row :gutter="20">
    <el-col :span="12">
      <el-form-item label="å¹´é¾„" prop="age">
        <el-input-number v-model="leadForm.age" :min="1" :max="120" />
      </el-form-item>
    </el-col>
    <el-col :span="12">
      <el-form-item label="å¹´æ”¶å…¥" prop="year_income">
        <el-input-number v-model="leadForm.year_income" :min="0" />
      </el-form-item>
    </el-col>
  </el-row>

  <!-- æ„å‘ä¿¡æ¯ -->
  <el-row :gutter="20">
    <el-col :span="12">
      <el-form-item label="æ„å‘çŠ¶æ€" prop="intention_state">
        <el-select v-model="leadForm.intention_state">
          <el-option label="åˆæ­¥æ„å‘" :value="1" />
          <el-option label="å¼ºçƒˆæ„å‘" :value="2" />
          <el-option label="å·²æˆäº¤" :value="3" />
          <el-option label="å·²æ”¾å¼ƒ" :value="4" />
        </el-select>
      </el-form-item>
    </el-col>
    <el-col :span="12">
      <el-form-item label="çº¿ç´¢æ¥æº" prop="source">
        <el-select v-model="leadForm.source">
          <el-option label="ç½‘ç«™å’¨è¯¢" :value="1" />
          <el-option label="ç”µè¯å’¨è¯¢" :value="2" />
          <el-option label="æœ‹å‹æ¨è" :value="3" />
          <el-option label="å¹¿å‘ŠæŠ•æ”¾" :value="4" />
          <el-option label="å…¶ä»–" :value="5" />
        </el-select>
      </el-form-item>
    </el-col>
  </el-row>

  <!-- å…¶ä»–ä¿¡æ¯ -->
  <el-form-item label="çº¿ç´¢æè¿°" prop="description">
    <el-input v-model="leadForm.description" type="textarea" :rows="4" />
  </el-form-item>
  
  <el-form-item label="ä¸‹æ¬¡è”ç³»æ—¶é—´" prop="next_contact_time">
    <el-date-picker
      v-model="leadForm.next_contact_time"
      type="datetime"
      placeholder="é€‰æ‹©ä¸‹æ¬¡è”ç³»æ—¶é—´"
    />
  </el-form-item>
</el-form>
```

### 4. **ğŸ‘ï¸ çº¿ç´¢è¯¦æƒ…æŸ¥çœ‹**

#### è¯¦æƒ…å±•ç¤º
```vue
<el-descriptions :column="2" border>
  <el-descriptions-item label="çº¿ç´¢ID">{{ leadDetail.id }}</el-descriptions-item>
  <el-descriptions-item label="å§“å">{{ leadDetail.full_name || '-' }}</el-descriptions-item>
  <el-descriptions-item label="æ‰‹æœºå·">{{ leadDetail.phone || '-' }}</el-descriptions-item>
  <el-descriptions-item label="å¹´æ”¶å…¥">
    <span v-if="leadDetail.year_income">Â¥{{ Number(leadDetail.year_income).toLocaleString() }}</span>
    <span v-else>-</span>
  </el-descriptions-item>
  <el-descriptions-item label="æ„å‘çŠ¶æ€">
    <el-tag :type="getIntentionColor(leadDetail.intention_state)">
      {{ getIntentionLabel(leadDetail.intention_state) }}
    </el-tag>
  </el-descriptions-item>
  <!-- æ›´å¤šå­—æ®µ... -->
</el-descriptions>
```

## ğŸ”§ æ ¸å¿ƒæ–¹æ³•å®ç°

### 1. **æ•°æ®åŠ è½½æ–¹æ³•**
```javascript
async loadLeads() {
  this.loading = true
  try {
    const res = await fetchPageData(this.currentPage, this.pageSize, '/api/leads', 'çº¿ç´¢ä¿¡æ¯è·å–å¤±è´¥')
    
    if (Array.isArray(res)) {
      this.leads = res.map(item => ({
        id: item.id || '',
        owner_id: item.owner_id || '',
        activity_id: item.activity_id || '',
        full_name: item.full_name || '',
        // æ˜ å°„æ‰€æœ‰æ•°æ®åº“å­—æ®µ...
      }))
    }
  } catch (error) {
    ElMessage.error('åŠ è½½çº¿ç´¢æ•°æ®å¤±è´¥')
  }
  this.loading = false
}
```

### 2. **çŠ¶æ€æ ‡ç­¾æ–¹æ³•**
```javascript
// è·å–æ„å‘çŠ¶æ€é¢œè‰²
getIntentionColor(state) {
  const colors = {
    1: 'info',      // åˆæ­¥æ„å‘
    2: 'warning',   // å¼ºçƒˆæ„å‘
    3: 'success',   // å·²æˆäº¤
    4: 'danger'     // å·²æ”¾å¼ƒ
  }
  return colors[state] || 'info'
}

// è·å–æ„å‘çŠ¶æ€æ ‡ç­¾
getIntentionLabel(state) {
  const labels = {
    1: 'åˆæ­¥æ„å‘',
    2: 'å¼ºçƒˆæ„å‘',
    3: 'å·²æˆäº¤',
    4: 'å·²æ”¾å¼ƒ'
  }
  return labels[state] || 'åˆæ­¥æ„å‘'
}
```

### 3. **CRUDæ“ä½œæ–¹æ³•**
```javascript
// ä¿å­˜çº¿ç´¢
saveLead() {
  this.$refs.leadFormRef.validate((valid) => {
    if (valid) {
      const data = {
        ...this.leadForm,
        create_time: new Date().toISOString().slice(0, 19).replace('T', ' '),
        create_by: 1,
        edit_time: new Date().toISOString().slice(0, 19).replace('T', ' '),
        edit_by: 1
      }

      const request = this.editingLead 
        ? doPut('/api/leads/' + this.editingLead.id, data)
        : doPost('/api/leads', data)

      request.then(res => {
        if (res.data && res.data.code === 200) {
          ElMessage.success(this.editingLead ? 'çº¿ç´¢æ›´æ–°æˆåŠŸ' : 'çº¿ç´¢åˆ›å»ºæˆåŠŸ')
          this.showAddDialog = false
          this.loadLeads()
        }
      })
    }
  })
}
```

## ğŸ“Š æ•°æ®éªŒè¯è§„åˆ™

### è¡¨å•éªŒè¯
```javascript
leadRules: {
  full_name: [
    { required: true, message: 'è¯·è¾“å…¥å§“å', trigger: 'blur' }
  ],
  phone: [
    { required: true, message: 'è¯·è¾“å…¥æ‰‹æœºå·', trigger: 'blur' },
    { pattern: /^1[3-9]\d{9}$/, message: 'è¯·è¾“å…¥æ­£ç¡®çš„æ‰‹æœºå·', trigger: 'blur' }
  ],
  intention_state: [
    { required: true, message: 'è¯·é€‰æ‹©æ„å‘çŠ¶æ€', trigger: 'change' }
  ],
  source: [
    { required: true, message: 'è¯·é€‰æ‹©çº¿ç´¢æ¥æº', trigger: 'change' }
  ]
}
```

## ğŸ¯ åŠŸèƒ½ç‰¹ç‚¹

### âœ… **å®Œæ•´çš„æ•°æ®åº“å­—æ®µæ”¯æŒ**
1. **åŸºæœ¬ä¿¡æ¯**: å§“åã€æ‰‹æœºå·ã€å¾®ä¿¡ã€QQã€é‚®ç®±
2. **ä¸ªäººä¿¡æ¯**: å¹´é¾„ã€èŒä¸šã€å¹´æ”¶å…¥ã€åœ°å€
3. **ä¸šåŠ¡ä¿¡æ¯**: æ„å‘çŠ¶æ€ã€æ„å‘äº§å“ã€çº¿ç´¢æ¥æºã€çº¿ç´¢çŠ¶æ€
4. **è·Ÿè¿›ä¿¡æ¯**: çº¿ç´¢æè¿°ã€ä¸‹æ¬¡è”ç³»æ—¶é—´
5. **ç³»ç»Ÿä¿¡æ¯**: åˆ›å»ºæ—¶é—´ã€ç¼–è¾‘æ—¶é—´ã€åˆ›å»ºäººã€ç¼–è¾‘äºº

### âœ… **ç”¨æˆ·ä½“éªŒä¼˜åŒ–**
1. **æœç´¢ç­›é€‰**: æ”¯æŒå§“åã€æ‰‹æœºå·ã€æ„å‘çŠ¶æ€ã€çº¿ç´¢æ¥æºç­›é€‰
2. **çŠ¶æ€æ ‡ç­¾**: å½©è‰²æ ‡ç­¾æ˜¾ç¤ºæ„å‘çŠ¶æ€
3. **é‡‘é¢æ ¼å¼åŒ–**: å¹´æ”¶å…¥æ˜¾ç¤ºåƒåˆ†ä½åˆ†éš”ç¬¦
4. **æ—¶é—´æ ¼å¼åŒ–**: ç»Ÿä¸€çš„æ—¶é—´æ˜¾ç¤ºæ ¼å¼
5. **åˆ†é¡µåŠŸèƒ½**: æ”¯æŒåˆ†é¡µæµè§ˆå’Œé¡µé¢å¤§å°è°ƒæ•´

### âœ… **æ•°æ®å®‰å…¨æ€§**
1. **è¡¨å•éªŒè¯**: å¿…å¡«å­—æ®µå’Œæ ¼å¼éªŒè¯
2. **æ‰‹æœºå·éªŒè¯**: æ­£åˆ™è¡¨è¾¾å¼éªŒè¯æ‰‹æœºå·æ ¼å¼
3. **æ•°æ®æ˜ å°„**: å®‰å…¨çš„æ•°æ®å­—æ®µæ˜ å°„
4. **é”™è¯¯å¤„ç†**: å®Œå–„çš„é”™è¯¯æç¤ºå’Œå¼‚å¸¸å¤„ç†

ç°åœ¨æ‚¨æ‹¥æœ‰äº†ä¸€ä¸ªå®Œæ•´çš„çº¿ç´¢ç®¡ç†é¡µé¢ï¼Œå®Œå…¨å¯¹åº”æ•°æ®åº“è¡¨ç»“æ„ï¼Œæ”¯æŒæ‰€æœ‰å­—æ®µçš„ç®¡ç†å’Œæ“ä½œï¼
