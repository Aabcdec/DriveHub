# Market/index.vue 活动趋势图优化说明

## 🎯 优化目标

基于已有的年度数据接口实现，为活动趋势图添加月度数据处理逻辑，确保：
- **年度模式**：使用现有接口获取年份数据和参与/转换人数
- **月度模式**：基于年度模式实现月度数据获取和渲染
- **周模式**：保持现有的默认数据显示

## ✅ 已完成的优化

### 1. 重构changeTimeRange方法

```javascript
changeTimeRange(range) {
  this.timeRange = range
  
  // 清空之前的数据
  this.data.yearList = []
  this.data.addList = []
  this.data.converter = []
  
  if (range === 'year') {
    // 年度数据处理
    const request1 = doGet("/api/lineData", {range});
    const request2 = doGet('/api/lineConverterData', {range});
    
    axios.all([request1, request2])
      .then(axios.spread((response1, response2) => {
        // 处理年度参与人数数据
        response1.data.forEach(item => {
          this.data.yearList.push(item.year);
          this.data.addList.push(item.count); // 参与人数
        })
        
        // 处理年度转换人数数据
        response2.data.forEach(item => {
          this.data.converter.push(item.count); // 转换人数
        })
        
        this.updateTrendChart();
      }))
      
  } else if (range === 'month') {
    // 月度数据处理 - 基于年的模式实现
    const request1 = doGet("/api/lineMonthData", {range}); // 月度参与人数接口
    const request2 = doGet('/api/lineMonthConverterData', {range}); // 月度转换人数接口
    
    axios.all([request1, request2])
      .then(axios.spread((response1, response2) => {
        // 处理月度参与人数数据
        response1.data.forEach(item => {
          this.data.yearList.push(item.month + '月'); // 转换为 "1月", "2月" 格式
          this.data.addList.push(item.count); // 参与人数
        })
        
        // 处理月度转换人数数据
        response2.data.forEach(item => {
          this.data.converter.push(item.count); // 转换人数
        })
        
        this.updateTrendChart();
      }))
      
  } else if (range === 'week') {
    // 周数据处理 - 使用默认数据
    this.data.yearList = ['周一', '周二', '周三', '周四', '周五', '周六', '周日'];
    this.data.addList = [120, 132, 101, 134, 190, 230, 210];
    this.data.converter = [22, 18, 19, 23, 29, 33, 31];
    
    this.updateTrendChart();
  }
}
```

### 2. 优化updateTrendChart方法

```javascript
updateTrendChart() {
  // 使用this.data中的数据更新图表
  const xAxisData = this.data.yearList;
  const seriesData1 = this.data.converter; // 转化人数
  const seriesData2 = this.data.addList; // 参与人数

  this.trendChartOption = {
    ...this.trendChartOption,
    xAxis: {
      ...this.trendChartOption.xAxis,
      data: xAxisData
    },
    series: [
      {
        ...this.trendChartOption.series[0],
        name: '转化人数',
        data: seriesData1
      },
      {
        ...this.trendChartOption.series[1],
        name: '参与人数',
        data: seriesData2
      }
    ]
  }
}
```

## 📊 数据处理逻辑

### 年度模式 (year)
- **接口1**: `/api/lineData` - 获取年度参与人数
- **接口2**: `/api/lineConverterData` - 获取年度转换人数
- **数据格式**: `{year: 2025, count: 41}`
- **X轴显示**: 年份 (如: 2023, 2024, 2025)

### 月度模式 (month) - 新增
- **接口1**: `/api/lineMonthData` - 获取月度参与人数 (需要后端实现)
- **接口2**: `/api/lineMonthConverterData` - 获取月度转换人数 (需要后端实现)
- **预期数据格式**: `{month: 1, count: 100}`, `{month: 2, count: 120}`
- **X轴显示**: 月份 (如: 1月, 2月, 3月, ..., 12月)

### 周模式 (week)
- **数据来源**: 前端默认数据
- **X轴显示**: 星期 (如: 周一, 周二, ..., 周日)

## 🔧 技术实现要点

### 1. 数据清理机制
- 每次切换时间范围时，清空之前的数据
- 避免数据累积和混乱

### 2. 统一的数据结构
- `this.data.yearList`: X轴标签数组
- `this.data.addList`: 参与人数数组
- `this.data.converter`: 转换人数数组

### 3. 异步数据处理
- 使用`axios.all`并行请求两个接口
- 确保数据完整后再更新图表

### 4. 错误处理
- 添加详细的错误日志
- 区分年度和月度请求失败

## 🚀 后端接口需要实现

### 月度参与人数接口
```javascript
GET /api/lineMonthData?range=month
// 返回格式:
[
  {month: 1, count: 100},
  {month: 2, count: 120},
  {month: 3, count: 95},
  // ... 12个月的数据
]
```

### 月度转换人数接口
```javascript
GET /api/lineMonthConverterData?range=month
// 返回格式:
[
  {month: 1, count: 15},
  {month: 2, count: 18},
  {month: 3, count: 12},
  // ... 12个月的数据
]
```

## 📝 注意事项

1. **不修改其他逻辑**：只修改了`changeTimeRange`和`updateTrendChart`方法
2. **保持数据格式一致**：月度接口应该返回与年度接口类似的数据格式
3. **X轴标签处理**：月度数据自动添加"月"后缀 (1 -> "1月")
4. **调试友好**：添加了详细的控制台日志
5. **向下兼容**：保持周模式的现有功能不变

## 🎯 使用效果

### 点击"年"按钮时
- 调用现有的年度接口
- X轴显示年份
- 显示年度参与人数和转换人数

### 点击"月"按钮时
- 调用新的月度接口 (需要后端实现)
- X轴显示月份 (1月-12月)
- 显示月度参与人数和转换人数

### 点击"周"按钮时
- 使用前端默认数据
- X轴显示星期
- 显示周度参与人数和转换人数

现在您只需要在后端实现两个月度接口，前端就能完美支持月度数据的显示了！
