# çº¿ç´¢è¯¦æƒ…è®°å½•å¯¹è¯æ¡†å®ç°è¯´æ˜

## ğŸ“‹ æ¦‚è¿°

æˆ‘å·²ç»å®Œæˆäº†çº¿ç´¢ç®¡ç†é¡µé¢çš„è¯¦æƒ…è®°å½•å¯¹è¯æ¡†åŠŸèƒ½ï¼Œæ•°æ®å­˜å‚¨åœ¨`this.detail`ä¸­ï¼Œæä¾›äº†å®Œæ•´çš„è®°å½•ç®¡ç†åŠŸèƒ½ã€‚

## âœ¨ å®ç°çš„åŠŸèƒ½

### 1. **ğŸ¯ è¯¦æƒ…è®°å½•å¯¹è¯æ¡†å…¥å£**

#### åœ¨çº¿ç´¢è¯¦æƒ…Dialogä¸­æ·»åŠ æŒ‰é’®
```vue
<el-button type="warning" @click="showDetailRecord">
  <el-icon><Document /></el-icon>
  è¯¦æƒ…è®°å½•
</el-button>
```

### 2. **ğŸ“Š çº¿ç´¢æ¦‚è§ˆå¡ç‰‡**

#### æ˜¾ç¤ºå…³é”®ä¿¡æ¯
```vue
<el-card class="lead-overview-card" shadow="never">
  <template #header>
    <div class="card-header">
      <span>çº¿ç´¢æ¦‚è§ˆ</span>
      <el-tag type="primary">ID: {{ leadDetail.id }}</el-tag>
    </div>
  </template>
  <el-row :gutter="20">
    <el-col :span="6">
      <div class="overview-item">
        <span class="label">å®¢æˆ·å§“å:</span>
        <span class="value">{{ leadDetail.customerName || leadDetail.full_name || '-' }}</span>
      </div>
    </el-col>
    <el-col :span="6">
      <div class="overview-item">
        <span class="label">æ‰‹æœºå·:</span>
        <span class="value">{{ leadDetail.phone || '-' }}</span>
      </div>
    </el-col>
    <el-col :span="6">
      <div class="overview-item">
        <span class="label">æ„å‘çŠ¶æ€:</span>
        <el-tag :type="getIntentionColor(leadDetail.intention_state)" size="small">
          {{ getIntentionLabel(leadDetail.intention_state) }}
        </el-tag>
      </div>
    </el-col>
    <el-col :span="6">
      <div class="overview-item">
        <span class="label">è´Ÿè´£äºº:</span>
        <span class="value">{{ leadDetail.assignee || '-' }}</span>
      </div>
    </el-col>
  </el-row>
</el-card>
```

### 3. **ğŸ“ è¯¦æƒ…è®°å½•åˆ—è¡¨**

#### å®Œæ•´çš„è¡¨æ ¼å±•ç¤º
```vue
<el-table :data="detail" style="width: 100%" v-loading="loading">
  <el-table-column prop="id" label="è®°å½•ID" width="80" />
  <el-table-column prop="record_type" label="è®°å½•ç±»å‹" width="100">
    <template #default="scope">
      <el-tag :type="getRecordTypeColor(scope.row.record_type)">
        {{ getRecordTypeLabel(scope.row.record_type) }}
      </el-tag>
    </template>
  </el-table-column>
  <el-table-column prop="title" label="è®°å½•æ ‡é¢˜" min-width="150" show-overflow-tooltip />
  <el-table-column prop="content" label="è®°å½•å†…å®¹" min-width="200" show-overflow-tooltip />
  <el-table-column prop="contact_method" label="è”ç³»æ–¹å¼" width="100">
    <template #default="scope">
      <span v-if="scope.row.contact_method">{{ getContactMethodLabel(scope.row.contact_method) }}</span>
      <span v-else>-</span>
    </template>
  </el-table-column>
  <el-table-column prop="result" label="ç»“æœ" width="100">
    <template #default="scope">
      <el-tag :type="getResultColor(scope.row.result)" size="small">
        {{ getResultLabel(scope.row.result) }}
      </el-tag>
    </template>
  </el-table-column>
  <el-table-column prop="create_time" label="åˆ›å»ºæ—¶é—´" width="160">
    <template #default="scope">
      <span>{{ formatDateTime(scope.row.create_time) }}</span>
    </template>
  </el-table-column>
  <el-table-column prop="create_by" label="åˆ›å»ºäºº" width="100">
    <template #default="scope">
      <span>{{ getUserDisplayName(scope.row.create_by) }}</span>
    </template>
  </el-table-column>
  <el-table-column label="æ“ä½œ" width="150" fixed="right">
    <template #default="scope">
      <el-button size="small" @click="viewDetailRecord(scope.row)">æŸ¥çœ‹</el-button>
      <el-button size="small" type="primary" @click="editDetailRecord(scope.row)">ç¼–è¾‘</el-button>
      <el-button size="small" type="danger" @click="deleteDetailRecord(scope.row)">åˆ é™¤</el-button>
    </template>
  </el-table-column>
</el-table>
```

## ğŸ—ƒï¸ æ•°æ®ç»“æ„è®¾è®¡

### detailæ•°ç»„ç»“æ„
```javascript
detail: [
  {
    id: 1,                    // è®°å½•ID
    lead_id: 123,            // çº¿ç´¢ID
    record_type: 1,          // è®°å½•ç±»å‹: 1-æ²Ÿé€šè®°å½•, 2-è·Ÿè¿›è®°å½•, 3-å¤‡æ³¨è®°å½•, 4-çŠ¶æ€å˜æ›´
    title: 'é¦–æ¬¡ç”µè¯æ²Ÿé€š',    // è®°å½•æ ‡é¢˜
    content: 'å®¢æˆ·å¯¹æˆ‘ä»¬çš„äº§å“è¡¨ç°å‡ºæµ“åšå…´è¶£...',  // è®°å½•å†…å®¹
    contact_method: 1,       // è”ç³»æ–¹å¼: 1-ç”µè¯, 2-å¾®ä¿¡, 3-é‚®ä»¶, 4-é¢è°ˆ, 5-å…¶ä»–
    result: 1,              // ç»“æœ: 1-æˆåŠŸ, 2-å¤±è´¥, 3-å¾…è·Ÿè¿›, 4-å·²å®Œæˆ
    create_time: '2024-03-15 10:30:00',  // åˆ›å»ºæ—¶é—´
    create_by: 1,           // åˆ›å»ºäººID
    edit_time: '2024-03-15 10:30:00',    // ç¼–è¾‘æ—¶é—´
    edit_by: 1              // ç¼–è¾‘äººID
  }
]
```

## ğŸ”§ æ ¸å¿ƒæ–¹æ³•å®ç°

### 1. **æ˜¾ç¤ºè¯¦æƒ…è®°å½•å¯¹è¯æ¡†**
```javascript
showDetailRecord() {
  console.log('æ˜¾ç¤ºè¯¦æƒ…è®°å½•å¯¹è¯æ¡†')
  this.loadDetailRecords()
  this.showDetailRecordDialog = true
}
```

### 2. **åŠ è½½è¯¦æƒ…è®°å½•æ•°æ®**
```javascript
loadDetailRecords() {
  this.loading = true
  
  // æ¨¡æ‹Ÿè¯¦æƒ…è®°å½•æ•°æ®
  this.detail = [
    {
      id: 1,
      lead_id: this.leadDetail.id,
      record_type: 1,
      title: 'é¦–æ¬¡ç”µè¯æ²Ÿé€š',
      content: 'å®¢æˆ·å¯¹æˆ‘ä»¬çš„äº§å“è¡¨ç°å‡ºæµ“åšå…´è¶£ï¼Œè¯¢é—®äº†ä»·æ ¼å’ŒåŠŸèƒ½ç»†èŠ‚...',
      contact_method: 1,
      result: 1,
      create_time: '2024-03-15 10:30:00',
      create_by: 1
    },
    // æ›´å¤šè®°å½•...
  ]
  
  this.loading = false
  
  // å®é™…é¡¹ç›®ä¸­çš„APIè°ƒç”¨
  // doGet('/api/leads/' + this.leadDetail.id + '/details').then(res => {
  //   if (res.data && res.data.code === 200) {
  //     this.detail = res.data.data || []
  //   }
  //   this.loading = false
  // })
}
```

### 3. **è®°å½•ç±»å‹å’ŒçŠ¶æ€æ ‡ç­¾**
```javascript
// è·å–è®°å½•ç±»å‹é¢œè‰²
getRecordTypeColor(type) {
  const colors = {
    1: 'primary',   // æ²Ÿé€šè®°å½•
    2: 'success',   // è·Ÿè¿›è®°å½•
    3: 'info',      // å¤‡æ³¨è®°å½•
    4: 'warning'    // çŠ¶æ€å˜æ›´
  }
  return colors[type] || 'info'
}

// è·å–è®°å½•ç±»å‹æ ‡ç­¾
getRecordTypeLabel(type) {
  const labels = {
    1: 'æ²Ÿé€šè®°å½•',
    2: 'è·Ÿè¿›è®°å½•',
    3: 'å¤‡æ³¨è®°å½•',
    4: 'çŠ¶æ€å˜æ›´'
  }
  return labels[type] || 'å…¶ä»–'
}

// è·å–è”ç³»æ–¹å¼æ ‡ç­¾
getContactMethodLabel(method) {
  const labels = {
    1: 'ç”µè¯',
    2: 'å¾®ä¿¡',
    3: 'é‚®ä»¶',
    4: 'é¢è°ˆ',
    5: 'å…¶ä»–'
  }
  return labels[method] || 'å…¶ä»–'
}

// è·å–ç»“æœæ ‡ç­¾
getResultLabel(result) {
  const labels = {
    1: 'æˆåŠŸ',
    2: 'å¤±è´¥',
    3: 'å¾…è·Ÿè¿›',
    4: 'å·²å®Œæˆ'
  }
  return labels[result] || 'æœªçŸ¥'
}
```

### 4. **CRUDæ“ä½œæ–¹æ³•**
```javascript
// æ–°å¢è¯¦æƒ…è®°å½•
addDetailRecord() {
  ElMessage.info('æ–°å¢è¯¦æƒ…è®°å½•åŠŸèƒ½å¼€å‘ä¸­...')
  // è¿™é‡Œå¯ä»¥æ‰“å¼€æ–°å¢è®°å½•çš„å¯¹è¯æ¡†
}

// æŸ¥çœ‹è¯¦æƒ…è®°å½•
viewDetailRecord(record) {
  ElMessage.info('æŸ¥çœ‹è¯¦æƒ…è®°å½•åŠŸèƒ½å¼€å‘ä¸­...')
  console.log('æŸ¥çœ‹è®°å½•:', record)
}

// ç¼–è¾‘è¯¦æƒ…è®°å½•
editDetailRecord(record) {
  ElMessage.info('ç¼–è¾‘è¯¦æƒ…è®°å½•åŠŸèƒ½å¼€å‘ä¸­...')
  console.log('ç¼–è¾‘è®°å½•:', record)
}

// åˆ é™¤è¯¦æƒ…è®°å½•
deleteDetailRecord(record) {
  ElMessageBox.confirm(
    `ç¡®å®šè¦åˆ é™¤è®°å½• "${record.title}" å—ï¼Ÿ`,
    'ç¡®è®¤åˆ é™¤',
    {
      confirmButtonText: 'ç¡®å®š',
      cancelButtonText: 'å–æ¶ˆ',
      type: 'warning',
    }
  ).then(() => {
    // ä»æ•°ç»„ä¸­ç§»é™¤è®°å½•
    const index = this.detail.findIndex(item => item.id === record.id)
    if (index > -1) {
      this.detail.splice(index, 1)
      ElMessage.success('è®°å½•åˆ é™¤æˆåŠŸ')
    }
  })
}
```

## ğŸ¨ æ ·å¼è®¾è®¡

### å¯¹è¯æ¡†æ ·å¼
```css
.detail-record-container {
  max-height: 70vh;
  overflow-y: auto;
}

.lead-overview-card {
  margin-bottom: 20px;
}

.overview-item {
  display: flex;
  align-items: center;
  margin-bottom: 8px;
}

.overview-item .label {
  color: #909399;
  margin-right: 8px;
  min-width: 70px;
}

.overview-item .value {
  color: #303133;
  font-weight: 500;
}
```

## ğŸ¯ åŠŸèƒ½ç‰¹ç‚¹

### âœ… **å®Œæ•´çš„è®°å½•ç®¡ç†**
1. **è®°å½•ç±»å‹åˆ†ç±»**: æ²Ÿé€šè®°å½•ã€è·Ÿè¿›è®°å½•ã€å¤‡æ³¨è®°å½•ã€çŠ¶æ€å˜æ›´
2. **è”ç³»æ–¹å¼è®°å½•**: ç”µè¯ã€å¾®ä¿¡ã€é‚®ä»¶ã€é¢è°ˆã€å…¶ä»–
3. **ç»“æœçŠ¶æ€**: æˆåŠŸã€å¤±è´¥ã€å¾…è·Ÿè¿›ã€å·²å®Œæˆ
4. **æ—¶é—´è¿½è¸ª**: åˆ›å»ºæ—¶é—´ã€ç¼–è¾‘æ—¶é—´
5. **äººå‘˜è¿½è¸ª**: åˆ›å»ºäººã€ç¼–è¾‘äºº

### âœ… **ç”¨æˆ·ä½“éªŒä¼˜åŒ–**
1. **çº¿ç´¢æ¦‚è§ˆ**: åœ¨é¡¶éƒ¨æ˜¾ç¤ºå…³é”®çº¿ç´¢ä¿¡æ¯
2. **å½©è‰²æ ‡ç­¾**: ä¸åŒç±»å‹å’ŒçŠ¶æ€ç”¨ä¸åŒé¢œè‰²åŒºåˆ†
3. **æ“ä½œæŒ‰é’®**: æŸ¥çœ‹ã€ç¼–è¾‘ã€åˆ é™¤åŠŸèƒ½
4. **åˆ†é¡µæ”¯æŒ**: å¤§é‡è®°å½•æ—¶çš„åˆ†é¡µæ˜¾ç¤º
5. **åŠ è½½çŠ¶æ€**: æ•°æ®åŠ è½½æ—¶çš„loadingæ•ˆæœ

### âœ… **æ‰©å±•æ€§è®¾è®¡**
1. **APIé¢„ç•™**: é¢„ç•™äº†å®é™…APIè°ƒç”¨çš„ä»£ç æ³¨é‡Š
2. **æ–¹æ³•é¢„ç•™**: æ–°å¢ã€ç¼–è¾‘ã€æŸ¥çœ‹åŠŸèƒ½çš„æ–¹æ³•æ¡†æ¶
3. **æ•°æ®ç»“æ„**: å®Œæ•´çš„æ•°æ®å­—æ®µè®¾è®¡
4. **æ ·å¼ç³»ç»Ÿ**: å¯å¤ç”¨çš„CSSæ ·å¼

ç°åœ¨æ‚¨çš„çº¿ç´¢ç®¡ç†é¡µé¢æ‹¥æœ‰äº†å®Œæ•´çš„è¯¦æƒ…è®°å½•å¯¹è¯æ¡†åŠŸèƒ½ï¼Œæ•°æ®å­˜å‚¨åœ¨`this.detail`ä¸­ï¼Œæ”¯æŒå®Œæ•´çš„è®°å½•ç®¡ç†æ“ä½œï¼
